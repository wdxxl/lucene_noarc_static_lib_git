//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: jar:file:wdxxl_lucene_350.jar!org/apache/lucene/util/SimpleStringInterner.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "java/lang/Math.h"
#include "org/apache/lucene/util/BitUtil.h"
#include "org/apache/lucene/util/SimpleStringInterner.h"
#include "org/apache/lucene/util/StringInterner.h"

@interface OrgApacheLuceneUtilSimpleStringInterner () {
 @public
  IOSObjectArray *cache_;
  jint maxChainLength_;
}

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilSimpleStringInterner, cache_, IOSObjectArray *)

@interface OrgApacheLuceneUtilSimpleStringInterner_Entry : NSObject {
 @public
  NSString *str_;
  jint hash__;
  OrgApacheLuceneUtilSimpleStringInterner_Entry *next_;
}

- (instancetype)initWithNSString:(NSString *)str
                         withInt:(jint)hash_
withOrgApacheLuceneUtilSimpleStringInterner_Entry:(OrgApacheLuceneUtilSimpleStringInterner_Entry *)next;

@end

J2OBJC_EMPTY_STATIC_INIT(OrgApacheLuceneUtilSimpleStringInterner_Entry)

J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilSimpleStringInterner_Entry, str_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneUtilSimpleStringInterner_Entry, next_, OrgApacheLuceneUtilSimpleStringInterner_Entry *)

__attribute__((unused)) static void OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(OrgApacheLuceneUtilSimpleStringInterner_Entry *self, NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next);

__attribute__((unused)) static OrgApacheLuceneUtilSimpleStringInterner_Entry *new_OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next) NS_RETURNS_RETAINED;

__attribute__((unused)) static OrgApacheLuceneUtilSimpleStringInterner_Entry *create_OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next);

J2OBJC_TYPE_LITERAL_HEADER(OrgApacheLuceneUtilSimpleStringInterner_Entry)

@implementation OrgApacheLuceneUtilSimpleStringInterner

- (instancetype)initWithInt:(jint)tableSize
                    withInt:(jint)maxChainLength {
  OrgApacheLuceneUtilSimpleStringInterner_initWithInt_withInt_(self, tableSize, maxChainLength);
  return self;
}

- (NSString *)internWithNSString:(NSString *)s {
  jint h = ((jint) [((NSString *) nil_chk(s)) hash]);
  jint slot = h & (((IOSObjectArray *) nil_chk(cache_))->size_ - 1);
  OrgApacheLuceneUtilSimpleStringInterner_Entry *first = IOSObjectArray_Get(self->cache_, slot);
  OrgApacheLuceneUtilSimpleStringInterner_Entry *nextToLast = nil;
  jint chainLength = 0;
  for (OrgApacheLuceneUtilSimpleStringInterner_Entry *e = first; e != nil; e = e->next_) {
    if (e->hash__ == h && (e->str_ == s || [((NSString *) nil_chk(e->str_)) compareToWithId:s] == 0)) {
      return e->str_;
    }
    chainLength++;
    if (e->next_ != nil) {
      nextToLast = e;
    }
  }
  s = [s java_intern];
  IOSObjectArray_SetAndConsume(self->cache_, slot, new_OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(s, h, first));
  if (chainLength >= maxChainLength_) {
    JreStrongAssign(&((OrgApacheLuceneUtilSimpleStringInterner_Entry *) nil_chk(nextToLast))->next_, nil);
  }
  return s;
}

- (void)dealloc {
  RELEASE_(cache_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LNSString;", 0x1, 1, 2, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithInt:withInt:);
  methods[1].selector = @selector(internWithNSString:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "cache_", "[LOrgApacheLuceneUtilSimpleStringInterner_Entry;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "maxChainLength_", "I", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "II", "intern", "LNSString;", "LOrgApacheLuceneUtilSimpleStringInterner_Entry;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilSimpleStringInterner = { "SimpleStringInterner", "org.apache.lucene.util", ptrTable, methods, fields, 7, 0x1, 2, 2, -1, 3, -1, -1, -1 };
  return &_OrgApacheLuceneUtilSimpleStringInterner;
}

@end

void OrgApacheLuceneUtilSimpleStringInterner_initWithInt_withInt_(OrgApacheLuceneUtilSimpleStringInterner *self, jint tableSize, jint maxChainLength) {
  OrgApacheLuceneUtilStringInterner_init(self);
  JreStrongAssignAndConsume(&self->cache_, [IOSObjectArray newArrayWithLength:JavaLangMath_maxWithInt_withInt_(1, OrgApacheLuceneUtilBitUtil_nextHighestPowerOfTwoWithInt_(tableSize)) type:OrgApacheLuceneUtilSimpleStringInterner_Entry_class_()]);
  self->maxChainLength_ = JavaLangMath_maxWithInt_withInt_(2, maxChainLength);
}

OrgApacheLuceneUtilSimpleStringInterner *new_OrgApacheLuceneUtilSimpleStringInterner_initWithInt_withInt_(jint tableSize, jint maxChainLength) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilSimpleStringInterner, initWithInt_withInt_, tableSize, maxChainLength)
}

OrgApacheLuceneUtilSimpleStringInterner *create_OrgApacheLuceneUtilSimpleStringInterner_initWithInt_withInt_(jint tableSize, jint maxChainLength) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilSimpleStringInterner, initWithInt_withInt_, tableSize, maxChainLength)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilSimpleStringInterner)

@implementation OrgApacheLuceneUtilSimpleStringInterner_Entry

- (instancetype)initWithNSString:(NSString *)str
                         withInt:(jint)hash_
withOrgApacheLuceneUtilSimpleStringInterner_Entry:(OrgApacheLuceneUtilSimpleStringInterner_Entry *)next {
  OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(self, str, hash_, next);
  return self;
}

- (void)dealloc {
  RELEASE_(str_);
  RELEASE_(next_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x2, -1, 0, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithNSString:withInt:withOrgApacheLuceneUtilSimpleStringInterner_Entry:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "str_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "hash__", "I", .constantValue.asLong = 0, 0x12, 1, -1, -1, -1 },
    { "next_", "LOrgApacheLuceneUtilSimpleStringInterner_Entry;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LNSString;ILOrgApacheLuceneUtilSimpleStringInterner_Entry;", "hash", "LOrgApacheLuceneUtilSimpleStringInterner;" };
  static const J2ObjcClassInfo _OrgApacheLuceneUtilSimpleStringInterner_Entry = { "Entry", "org.apache.lucene.util", ptrTable, methods, fields, 7, 0xa, 1, 3, 2, -1, -1, -1, -1 };
  return &_OrgApacheLuceneUtilSimpleStringInterner_Entry;
}

@end

void OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(OrgApacheLuceneUtilSimpleStringInterner_Entry *self, NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next) {
  NSObject_init(self);
  JreStrongAssign(&self->str_, str);
  self->hash__ = hash_;
  JreStrongAssign(&self->next_, next);
}

OrgApacheLuceneUtilSimpleStringInterner_Entry *new_OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneUtilSimpleStringInterner_Entry, initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_, str, hash_, next)
}

OrgApacheLuceneUtilSimpleStringInterner_Entry *create_OrgApacheLuceneUtilSimpleStringInterner_Entry_initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_(NSString *str, jint hash_, OrgApacheLuceneUtilSimpleStringInterner_Entry *next) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneUtilSimpleStringInterner_Entry, initWithNSString_withInt_withOrgApacheLuceneUtilSimpleStringInterner_Entry_, str, hash_, next)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneUtilSimpleStringInterner_Entry)
