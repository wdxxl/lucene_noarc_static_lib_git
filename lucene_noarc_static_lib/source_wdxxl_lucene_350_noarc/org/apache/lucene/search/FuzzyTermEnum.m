//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: jar:file:wdxxl_lucene_350.jar!org/apache/lucene/search/FuzzyTermEnum.java
//

#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/Math.h"
#include "org/apache/lucene/index/IndexReader.h"
#include "org/apache/lucene/index/Term.h"
#include "org/apache/lucene/index/TermEnum.h"
#include "org/apache/lucene/search/FilteredTermEnum.h"
#include "org/apache/lucene/search/FuzzyQuery.h"
#include "org/apache/lucene/search/FuzzyTermEnum.h"

@interface OrgApacheLuceneSearchFuzzyTermEnum () {
 @public
  IOSIntArray *p_;
  IOSIntArray *d_;
  jfloat similarity_;
  jboolean endEnum_;
  OrgApacheLuceneIndexTerm *searchTerm_;
  NSString *field_;
  IOSCharArray *text_;
  NSString *prefix_;
  jfloat minimumSimilarity_;
  jfloat scale_factor_;
}

- (jfloat)similarityWithNSString:(NSString *)target;

- (jint)calculateMaxDistanceWithInt:(jint)m;

@end

J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, p_, IOSIntArray *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, d_, IOSIntArray *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, searchTerm_, OrgApacheLuceneIndexTerm *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, field_, NSString *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, text_, IOSCharArray *)
J2OBJC_FIELD_SETTER(OrgApacheLuceneSearchFuzzyTermEnum, prefix_, NSString *)

__attribute__((unused)) static jfloat OrgApacheLuceneSearchFuzzyTermEnum_similarityWithNSString_(OrgApacheLuceneSearchFuzzyTermEnum *self, NSString *target);

__attribute__((unused)) static jint OrgApacheLuceneSearchFuzzyTermEnum_calculateMaxDistanceWithInt_(OrgApacheLuceneSearchFuzzyTermEnum *self, jint m);

@implementation OrgApacheLuceneSearchFuzzyTermEnum

- (instancetype)initWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                           withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term {
  OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(self, reader, term);
  return self;
}

- (instancetype)initWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                           withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term
                                              withFloat:(jfloat)minSimilarity {
  OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_(self, reader, term, minSimilarity);
  return self;
}

- (instancetype)initWithOrgApacheLuceneIndexIndexReader:(OrgApacheLuceneIndexIndexReader *)reader
                           withOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term
                                              withFloat:(jfloat)minSimilarity
                                                withInt:(jint)prefixLength {
  OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(self, reader, term, minSimilarity, prefixLength);
  return self;
}

- (jboolean)termCompareWithOrgApacheLuceneIndexTerm:(OrgApacheLuceneIndexTerm *)term {
  if (field_ == [((OrgApacheLuceneIndexTerm *) nil_chk(term)) field] && [((NSString *) nil_chk([term text])) java_hasPrefix:prefix_]) {
    NSString *target = [((NSString *) nil_chk([term text])) java_substring:[((NSString *) nil_chk(prefix_)) java_length]];
    self->similarity_ = OrgApacheLuceneSearchFuzzyTermEnum_similarityWithNSString_(self, target);
    return (similarity_ > minimumSimilarity_);
  }
  endEnum_ = true;
  return false;
}

- (jfloat)difference {
  return (similarity_ - minimumSimilarity_) * scale_factor_;
}

- (jboolean)endEnum {
  return endEnum_;
}

- (jfloat)similarityWithNSString:(NSString *)target {
  return OrgApacheLuceneSearchFuzzyTermEnum_similarityWithNSString_(self, target);
}

- (jint)calculateMaxDistanceWithInt:(jint)m {
  return OrgApacheLuceneSearchFuzzyTermEnum_calculateMaxDistanceWithInt_(self, m);
}

- (void)close {
  JreStrongAssign(&p_, JreStrongAssign(&d_, nil));
  JreStrongAssign(&searchTerm_, nil);
  [super close];
}

- (void)dealloc {
  RELEASE_(p_);
  RELEASE_(d_);
  RELEASE_(searchTerm_);
  RELEASE_(field_);
  RELEASE_(text_);
  RELEASE_(prefix_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, 1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 2, 1, -1, -1, -1 },
    { NULL, NULL, 0x1, -1, 3, 1, -1, -1, -1 },
    { NULL, "Z", 0x14, 4, 5, -1, -1, -1, -1 },
    { NULL, "F", 0x11, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x11, -1, -1, -1, -1, -1, -1 },
    { NULL, "F", 0x2, 6, 7, -1, -1, -1, -1 },
    { NULL, "I", 0x2, 8, 9, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneIndexTerm:);
  methods[1].selector = @selector(initWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneIndexTerm:withFloat:);
  methods[2].selector = @selector(initWithOrgApacheLuceneIndexIndexReader:withOrgApacheLuceneIndexTerm:withFloat:withInt:);
  methods[3].selector = @selector(termCompareWithOrgApacheLuceneIndexTerm:);
  methods[4].selector = @selector(difference);
  methods[5].selector = @selector(endEnum);
  methods[6].selector = @selector(similarityWithNSString:);
  methods[7].selector = @selector(calculateMaxDistanceWithInt:);
  methods[8].selector = @selector(close);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "p_", "[I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "d_", "[I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "similarity_", "F", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "endEnum_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "searchTerm_", "LOrgApacheLuceneIndexTerm;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "field_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "text_", "[C", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "prefix_", "LNSString;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "minimumSimilarity_", "F", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "scale_factor_", "F", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneIndexIndexReader;LOrgApacheLuceneIndexTerm;", "LJavaIoIOException;", "LOrgApacheLuceneIndexIndexReader;LOrgApacheLuceneIndexTerm;F", "LOrgApacheLuceneIndexIndexReader;LOrgApacheLuceneIndexTerm;FI", "termCompare", "LOrgApacheLuceneIndexTerm;", "similarity", "LNSString;", "calculateMaxDistance", "I" };
  static const J2ObjcClassInfo _OrgApacheLuceneSearchFuzzyTermEnum = { "FuzzyTermEnum", "org.apache.lucene.search", ptrTable, methods, fields, 7, 0x11, 9, 10, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneSearchFuzzyTermEnum;
}

@end

void OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneSearchFuzzyTermEnum *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term) {
  OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(self, reader, term, OrgApacheLuceneSearchFuzzyQuery_defaultMinSimilarity, OrgApacheLuceneSearchFuzzyQuery_defaultPrefixLength);
}

OrgApacheLuceneSearchFuzzyTermEnum *new_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_, reader, term)
}

OrgApacheLuceneSearchFuzzyTermEnum *create_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_, reader, term)
}

void OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_(OrgApacheLuceneSearchFuzzyTermEnum *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity) {
  OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(self, reader, term, minSimilarity, OrgApacheLuceneSearchFuzzyQuery_defaultPrefixLength);
}

OrgApacheLuceneSearchFuzzyTermEnum *new_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_, reader, term, minSimilarity)
}

OrgApacheLuceneSearchFuzzyTermEnum *create_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_, reader, term, minSimilarity)
}

void OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(OrgApacheLuceneSearchFuzzyTermEnum *self, OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity, jint prefixLength) {
  OrgApacheLuceneSearchFilteredTermEnum_init(self);
  self->endEnum_ = false;
  JreStrongAssign(&self->searchTerm_, nil);
  if (minSimilarity >= 1.0f) @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"minimumSimilarity cannot be greater than or equal to 1");
  else if (minSimilarity < 0.0f) @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"minimumSimilarity cannot be less than 0");
  if (prefixLength < 0) @throw create_JavaLangIllegalArgumentException_initWithNSString_(@"prefixLength cannot be less than 0");
  self->minimumSimilarity_ = minSimilarity;
  self->scale_factor_ = 1.0f / (1.0f - self->minimumSimilarity_);
  JreStrongAssign(&self->searchTerm_, term);
  JreStrongAssign(&self->field_, [((OrgApacheLuceneIndexTerm *) nil_chk(self->searchTerm_)) field]);
  jint fullSearchTermLength = [((NSString *) nil_chk([((OrgApacheLuceneIndexTerm *) nil_chk(self->searchTerm_)) text])) java_length];
  jint realPrefixLength = prefixLength > fullSearchTermLength ? fullSearchTermLength : prefixLength;
  JreStrongAssign(&self->text_, [((NSString *) nil_chk([((NSString *) nil_chk([((OrgApacheLuceneIndexTerm *) nil_chk(self->searchTerm_)) text])) java_substring:realPrefixLength])) java_toCharArray]);
  JreStrongAssign(&self->prefix_, [((NSString *) nil_chk([((OrgApacheLuceneIndexTerm *) nil_chk(self->searchTerm_)) text])) java_substring:0 endIndex:realPrefixLength]);
  JreStrongAssignAndConsume(&self->p_, [IOSIntArray newArrayWithLength:((IOSCharArray *) nil_chk(self->text_))->size_ + 1]);
  JreStrongAssignAndConsume(&self->d_, [IOSIntArray newArrayWithLength:self->text_->size_ + 1]);
  [self setEnumWithOrgApacheLuceneIndexTermEnum:[((OrgApacheLuceneIndexIndexReader *) nil_chk(reader)) termsWithOrgApacheLuceneIndexTerm:create_OrgApacheLuceneIndexTerm_initWithNSString_withNSString_([((OrgApacheLuceneIndexTerm *) nil_chk(self->searchTerm_)) field], self->prefix_)]];
}

OrgApacheLuceneSearchFuzzyTermEnum *new_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity, jint prefixLength) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_, reader, term, minSimilarity, prefixLength)
}

OrgApacheLuceneSearchFuzzyTermEnum *create_OrgApacheLuceneSearchFuzzyTermEnum_initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_(OrgApacheLuceneIndexIndexReader *reader, OrgApacheLuceneIndexTerm *term, jfloat minSimilarity, jint prefixLength) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneSearchFuzzyTermEnum, initWithOrgApacheLuceneIndexIndexReader_withOrgApacheLuceneIndexTerm_withFloat_withInt_, reader, term, minSimilarity, prefixLength)
}

jfloat OrgApacheLuceneSearchFuzzyTermEnum_similarityWithNSString_(OrgApacheLuceneSearchFuzzyTermEnum *self, NSString *target) {
  jint m = [((NSString *) nil_chk(target)) java_length];
  jint n = ((IOSCharArray *) nil_chk(self->text_))->size_;
  if (n == 0) {
    return [((NSString *) nil_chk(self->prefix_)) java_length] == 0 ? 0.0f : 1.0f - ((jfloat) m / [self->prefix_ java_length]);
  }
  if (m == 0) {
    return [((NSString *) nil_chk(self->prefix_)) java_length] == 0 ? 0.0f : 1.0f - ((jfloat) n / [self->prefix_ java_length]);
  }
  jint maxDistance = OrgApacheLuceneSearchFuzzyTermEnum_calculateMaxDistanceWithInt_(self, m);
  if (maxDistance < JavaLangMath_absWithInt_(m - n)) {
    return 0.0f;
  }
  for (jint i = 0; i <= n; ++i) {
    *IOSIntArray_GetRef(nil_chk(self->p_), i) = i;
  }
  for (jint j = 1; j <= m; ++j) {
    jint bestPossibleEditDistance = m;
    jchar t_j = [target charAtWithInt:j - 1];
    *IOSIntArray_GetRef(nil_chk(self->d_), 0) = j;
    for (jint i = 1; i <= n; ++i) {
      if (t_j != IOSCharArray_Get(self->text_, i - 1)) {
        *IOSIntArray_GetRef(nil_chk(self->d_), i) = JavaLangMath_minWithInt_withInt_(JavaLangMath_minWithInt_withInt_(IOSIntArray_Get(self->d_, i - 1), IOSIntArray_Get(nil_chk(self->p_), i)), IOSIntArray_Get(nil_chk(self->p_), i - 1)) + 1;
      }
      else {
        *IOSIntArray_GetRef(nil_chk(self->d_), i) = JavaLangMath_minWithInt_withInt_(JavaLangMath_minWithInt_withInt_(IOSIntArray_Get(self->d_, i - 1) + 1, IOSIntArray_Get(nil_chk(self->p_), i) + 1), IOSIntArray_Get(nil_chk(self->p_), i - 1));
      }
      bestPossibleEditDistance = JavaLangMath_minWithInt_withInt_(bestPossibleEditDistance, IOSIntArray_Get(nil_chk(self->d_), i));
    }
    if (j > maxDistance && bestPossibleEditDistance > maxDistance) {
      return 0.0f;
    }
    IOSIntArray *_d = self->p_;
    JreStrongAssign(&self->p_, self->d_);
    JreStrongAssign(&self->d_, _d);
  }
  return 1.0f - ((jfloat) IOSIntArray_Get(nil_chk(self->p_), n) / (jfloat) ([((NSString *) nil_chk(self->prefix_)) java_length] + JavaLangMath_minWithInt_withInt_(n, m)));
}

jint OrgApacheLuceneSearchFuzzyTermEnum_calculateMaxDistanceWithInt_(OrgApacheLuceneSearchFuzzyTermEnum *self, jint m) {
  return JreFpToInt(((1 - self->minimumSimilarity_) * (JavaLangMath_minWithInt_withInt_(((IOSCharArray *) nil_chk(self->text_))->size_, m) + [((NSString *) nil_chk(self->prefix_)) java_length])));
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneSearchFuzzyTermEnum)
