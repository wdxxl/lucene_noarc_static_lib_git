//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: jar:file:wdxxl_lucene_350.jar!org/apache/lucene/index/FormatPostingsPositionsWriter.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "java/io/Closeable.h"
#include "org/apache/lucene/index/DefaultSkipListWriter.h"
#include "org/apache/lucene/index/FieldInfo.h"
#include "org/apache/lucene/index/FieldInfos.h"
#include "org/apache/lucene/index/FormatPostingsDocsWriter.h"
#include "org/apache/lucene/index/FormatPostingsFieldsWriter.h"
#include "org/apache/lucene/index/FormatPostingsPositionsConsumer.h"
#include "org/apache/lucene/index/FormatPostingsPositionsWriter.h"
#include "org/apache/lucene/index/FormatPostingsTermsWriter.h"
#include "org/apache/lucene/index/IndexFileNames.h"
#include "org/apache/lucene/index/SegmentWriteState.h"
#include "org/apache/lucene/store/Directory.h"
#include "org/apache/lucene/store/IndexOutput.h"
#include "org/apache/lucene/util/IOUtils.h"

@implementation OrgApacheLuceneIndexFormatPostingsPositionsWriter

- (instancetype)initWithOrgApacheLuceneIndexSegmentWriteState:(OrgApacheLuceneIndexSegmentWriteState *)state
             withOrgApacheLuceneIndexFormatPostingsDocsWriter:(OrgApacheLuceneIndexFormatPostingsDocsWriter *)parent {
  OrgApacheLuceneIndexFormatPostingsPositionsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_(self, state, parent);
  return self;
}

- (void)addPositionWithInt:(jint)position
             withByteArray:(IOSByteArray *)payload
                   withInt:(jint)payloadOffset
                   withInt:(jint)payloadLength {
  JreAssert((!omitTermFreqAndPositions_), (@"omitTermFreqAndPositions is true"));
  JreAssert((out_ != nil), (@"org/apache/lucene/index/FormatPostingsPositionsWriter.java:57 condition failed: assert out != null;"));
  jint delta = position - lastPosition_;
  lastPosition_ = position;
  if (storePayloads_) {
    if (payloadLength != lastPayloadLength_) {
      lastPayloadLength_ = payloadLength;
      [((OrgApacheLuceneStoreIndexOutput *) nil_chk(out_)) writeVIntWithInt:(JreLShift32(delta, 1)) | 1];
      [out_ writeVIntWithInt:payloadLength];
    }
    else [((OrgApacheLuceneStoreIndexOutput *) nil_chk(out_)) writeVIntWithInt:JreLShift32(delta, 1)];
    if (payloadLength > 0) [out_ writeBytesWithByteArray:payload withInt:payloadLength];
  }
  else [((OrgApacheLuceneStoreIndexOutput *) nil_chk(out_)) writeVIntWithInt:delta];
}

- (void)setFieldWithOrgApacheLuceneIndexFieldInfo:(OrgApacheLuceneIndexFieldInfo *)fieldInfo {
  omitTermFreqAndPositions_ = (((OrgApacheLuceneIndexFieldInfo *) nil_chk(fieldInfo))->indexOptions_ == JreLoadEnum(OrgApacheLuceneIndexFieldInfo_IndexOptions, DOCS_ONLY));
  storePayloads_ = omitTermFreqAndPositions_ ? false : fieldInfo->storePayloads_;
}

- (void)finish {
  lastPosition_ = 0;
  lastPayloadLength_ = -1;
}

- (void)close {
  OrgApacheLuceneUtilIOUtils_closeWithJavaIoCloseableArray_([IOSObjectArray arrayWithObjects:(id[]){ out_ } count:1 type:JavaIoCloseable_class_()]);
}

- (void)__javaClone:(OrgApacheLuceneIndexFormatPostingsPositionsWriter *)original {
  [super __javaClone:original];
  [parent_ release];
}

- (void)dealloc {
  RELEASE_(out_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, 1, -1, -1, -1 },
    { NULL, "V", 0x0, 2, 3, 1, -1, -1, -1 },
    { NULL, "V", 0x0, 4, 5, -1, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOrgApacheLuceneIndexSegmentWriteState:withOrgApacheLuceneIndexFormatPostingsDocsWriter:);
  methods[1].selector = @selector(addPositionWithInt:withByteArray:withInt:withInt:);
  methods[2].selector = @selector(setFieldWithOrgApacheLuceneIndexFieldInfo:);
  methods[3].selector = @selector(finish);
  methods[4].selector = @selector(close);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "parent_", "LOrgApacheLuceneIndexFormatPostingsDocsWriter;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "out_", "LOrgApacheLuceneStoreIndexOutput;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "omitTermFreqAndPositions_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "storePayloads_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "lastPayloadLength_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "lastPosition_", "I", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgApacheLuceneIndexSegmentWriteState;LOrgApacheLuceneIndexFormatPostingsDocsWriter;", "LJavaIoIOException;", "addPosition", "I[BII", "setField", "LOrgApacheLuceneIndexFieldInfo;" };
  static const J2ObjcClassInfo _OrgApacheLuceneIndexFormatPostingsPositionsWriter = { "FormatPostingsPositionsWriter", "org.apache.lucene.index", ptrTable, methods, fields, 7, 0x10, 5, 6, -1, -1, -1, -1, -1 };
  return &_OrgApacheLuceneIndexFormatPostingsPositionsWriter;
}

@end

void OrgApacheLuceneIndexFormatPostingsPositionsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_(OrgApacheLuceneIndexFormatPostingsPositionsWriter *self, OrgApacheLuceneIndexSegmentWriteState *state, OrgApacheLuceneIndexFormatPostingsDocsWriter *parent) {
  OrgApacheLuceneIndexFormatPostingsPositionsConsumer_init(self);
  self->lastPayloadLength_ = -1;
  self->parent_ = parent;
  self->omitTermFreqAndPositions_ = ((OrgApacheLuceneIndexFormatPostingsDocsWriter *) nil_chk(parent))->omitTermFreqAndPositions_;
  if ([((OrgApacheLuceneIndexFieldInfos *) nil_chk(((OrgApacheLuceneIndexFormatPostingsFieldsWriter *) nil_chk(((OrgApacheLuceneIndexFormatPostingsTermsWriter *) nil_chk(parent->parent_))->parent_))->fieldInfos_)) hasProx]) {
    JreStrongAssign(&self->out_, [((OrgApacheLuceneStoreDirectory *) nil_chk(parent->parent_->parent_->dir_)) createOutputWithNSString:OrgApacheLuceneIndexIndexFileNames_segmentFileNameWithNSString_withNSString_(parent->parent_->parent_->segment_, OrgApacheLuceneIndexIndexFileNames_PROX_EXTENSION)]);
    [((OrgApacheLuceneIndexDefaultSkipListWriter *) nil_chk(parent->skipListWriter_)) setProxOutputWithOrgApacheLuceneStoreIndexOutput:self->out_];
  }
  else JreStrongAssign(&self->out_, nil);
}

OrgApacheLuceneIndexFormatPostingsPositionsWriter *new_OrgApacheLuceneIndexFormatPostingsPositionsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_(OrgApacheLuceneIndexSegmentWriteState *state, OrgApacheLuceneIndexFormatPostingsDocsWriter *parent) {
  J2OBJC_NEW_IMPL(OrgApacheLuceneIndexFormatPostingsPositionsWriter, initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_, state, parent)
}

OrgApacheLuceneIndexFormatPostingsPositionsWriter *create_OrgApacheLuceneIndexFormatPostingsPositionsWriter_initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_(OrgApacheLuceneIndexSegmentWriteState *state, OrgApacheLuceneIndexFormatPostingsDocsWriter *parent) {
  J2OBJC_CREATE_IMPL(OrgApacheLuceneIndexFormatPostingsPositionsWriter, initWithOrgApacheLuceneIndexSegmentWriteState_withOrgApacheLuceneIndexFormatPostingsDocsWriter_, state, parent)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(OrgApacheLuceneIndexFormatPostingsPositionsWriter)
